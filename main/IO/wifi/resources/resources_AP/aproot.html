<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<link href="" rel="icon" type="image/x-icon" />
<link type="text/css" href="dimlux.css" rel="stylesheet"/>
<title>Ballast setup</title>
</head>

<body style = "background-color:black; color:#ccc; font-family: arial;">

<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAfCAMAAACVvXI7AAADAFBMVEUAAAAAADMAAGYAAJkAAMwAAP8AMwAAMzMAM2YAM5kAM8wAM/8AZgAAZjMAZmYAZpkAZswAZv8AmQAAmTMAmWYAmZkAmcwAmf8AzAAAzDMAzGYAzJkAzMwAzP8A/wAA/zMA/2YA/5kA/8wA//8zAAAzADMzAGYzAJkzAMwzAP8zMwAzMzMzM2YzM5kzM8wzM/8zZgAzZjMzZmYzZpkzZswzZv8zmQAzmTMzmWYzmZkzmcwzmf8zzAAzzDMzzGYzzJkzzMwzzP8z/wAz/zMz/2Yz/5kz/8wz//9mAABmADNmAGZmAJlmAMxmAP9mMwBmMzNmM2ZmM5lmM8xmM/9mZgBmZjNmZmZmZplmZsxmZv9mmQBmmTNmmWZmmZlmmcxmmf9mzABmzDNmzGZmzJlmzMxmzP9m/wBm/zNm/2Zm/5lm/8xm//+ZAACZADOZAGaZAJmZAMyZAP+ZMwCZMzOZM2aZM5mZM8yZM/+ZZgCZZjOZZmaZZpmZZsyZZv+ZmQCZmTOZmWaZmZmZmcyZmf+ZzACZzDOZzGaZzJmZzMyZzP+Z/wCZ/zOZ/2aZ/5mZ/8yZ///MAADMADPMAGbMAJnMAMzMAP/MMwDMMzPMM2bMM5nMM8zMM//MZgDMZjPMZmbMZpnMZszMZv/MmQDMmTPMmWbMmZnMmczMmf/MzADMzDPMzGbMzJnMzMzMzP/M/wDM/zPM/2bM/5nM/8zM////AAD/ADP/AGb/AJn/AMz/AP//MwD/MzP/M2b/M5n/M8z/M///ZgD/ZjP/Zmb/Zpn/Zsz/Zv//mQD/mTP/mWb/mZn/mcz/mf//zAD/zDP/zGb/zJn/zMz/zP///wD//zP//2b//5n//8z///8AAACXVkuITUV6RT5sPDdeNDBQLClBJCEzHBolFBMWDAsHBAPUfWbUfWfUfGfUfGjUe2jVe2nVe2rVemvVeWvVeGzVd23Wdm7Wdm/WdW/VdHDObmy+ZmSuXFugVVWSTU2ERUZ2PT9nNTdYLTBKJig8HiAtFhgfDxHCaOGrAAAA2XRSTlP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A9EGGvAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAfxJREFUWIXtlj16wjAMhjkMWdBJWJql+CLN0ix9cgs6tB3o6PtwndrxnyRbAZqkCX34JiIUSa9tydls/o1eT6e3V6PD89POaOlyfi8DwuS4asu1Xbq6G5SDFLgOd8B1EYTJbVddrw7rVhCqj/VwjQP5JvoMWLAA15QglMqoDVzb+blmA8FAXoartlwwB9ZfglC1bfvisCbhWg6EczXNKK7VgDA1TdMfw+parrWCYB2PR8e1ryoRa+0gX17vSZ5rb7AQ1268YG5Vw1r6Kn6orE6QUhB9gPwDzBQcQXEbDVjOX4jNKrO/lRBJJYs+y9I+MBCrtXXU0fgpFsh6UR8BJHsrKNgcFUvn1sCX2ZOR/FqZnbDqglmVk+XM3KCmBYlVx+gUg4GgZAoVlCcb2sf0nhT7OpDwdvTE4bR/0FCIed8SGzL0F5QaMvqTLrQGyL0maPbL3vL2hzOpBnpEb2iTd/RIktdG9khwF+sdC4IGSn9eMci4HimB8Nl4TvssJQMUZxjEr5KfHhiEDBqpLenYRDVnJmBD/4zSZuPXDd8ujl9harEkkFoAg7Dhpjs/3EOS/tqkwb1Tyh/5I4ZpjdIKDQ5SfyNeBMGbj0Hyo0DlPxJkp7jeIZBfMLo5+eVPpoyCtBji1MqEp1b/DEpMMeyECoifIvizSWthfj20Bv0Azaw4f2xcq4IAAAAASUVORK5CYII=">

<H1>Ballast preferences</H1>

<form id="loginForm" action="">
<fieldset>

<table>

<tr>
<td><label>Current SSID</label></td>
<td> <label id="ssid"> </label></td>
</tr>

<tr>
<td><label>Software version:</label></td>
<td> <label id="swversion"> </label></td>
</tr>

<tr> <td> <BR></td> <td> </td>  </tr>

<tr>
<td><label>Ballast name</label></td>
<td><input type="text" id="name" name="name" maxlength="64"></td>
</tr>

<tr>
<td><label>Ballast location</label></td>
<td><input type="text" id="location" name="location" maxlength="64"></td>
</tr>

<tr><td><BR></td><td></td></tr>

<tr>
<td><label>Wifi mode</label></td>
<td>
<select name="ctrlmode" id="ctrlmode">
<option selected value="Wifi enabled">Wifi enabled</option>
<option value="Wifi disabled">Wifi disabled</option>
</select> 
</td>
</tr>

<tr>
<td><label>Wifi AP SSID name</label></td>
<td><input type="text" id="apname" name="apname" maxlength="64" list="apslist">

<datalist id="apslist">
</datalist>
</td>
</tr>

<tr>
<td><label>Wifi AP Password</label></td>
<td><input type="password" id="appassword" name="appassword" maxlength="64"></td>
</tr>

<tr><td><BR></td><td></td></tr>

<tr>
<td><label>IP mode</label></td>
<td>
<select name="ipmode" id="ipmode">
<option value="DHCP">DHCP</option>
<option value="fixed">fixed</option>
</select> 
</td>
</tr>

<tr>
<td><label>IP address</label></td>
<td><input type="text" id="ipaddress" name="ipaddress" maxlength="64"></td>
</tr>

<tr> <td> <BR></td> <td> </td>  </tr>

<tr>
<td><label>Time update NTP</label></td>
<td><input type="checkbox" id="ntp" name="ntp" checked></td>
</tr>
</table>

<table>
<tr>
<td><label>7 segment dimlevel</label></td> 
<td><input class="slidecontainer" type="range" min="50" max="100" value="50" class="slider" id="dimlevel" name="dimlevel"></td>
<td> <span id="slidervalue"></span></td>
</tr>
</table>

<table>

<tr> <td> <BR></td> <td> </td>  </tr>

<tr>
<td><button>Submit</button></td>
<td> <label id="cause"> </label></td>
</tr>

</table>
</fieldset>
</form>

<br>
<div id="msg"></div>

<label id="timer"> </label>

<script type="text/javascript" src="aproot.js"></script> 

<script>
var slider = document.getElementById("dimlevel");
var output = document.getElementById("slidervalue");
output.innerHTML = slider.value;
slider.oninput = function() { output.innerHTML = this.value + " %"; }
</script>

<script>
document.getElementById("loginForm").addEventListener("submit", (e) => {

setInterval("timerUp()",1000);

e.preventDefault(); 
const formData = new FormData(e.target); 
const data = Array.from(formData.entries()).reduce((memo, pair) => ({...memo, [pair[0]]: pair[1],  }), {}); 
var xhr = new XMLHttpRequest(); 
xhr.open("POST", "https://192.168.1.1/connection", true); 
xhr.setRequestHeader('Content-Type', 'application/json'); 
xhr.send(JSON.stringify(data)); 
});
</script>

<script>
var timer=0;

function timerUp() {
timer++;
var resetat=5; //change this number to adjust the length of time in seconds
if(timer==resetat)
    {
	document.getElementById('loginForm').innerHTML='<h3> Please set your browser to new IP address of ballast...</h3>';
    }
var tleft=resetat-timer;
if (tleft < 0)
	{
	tleft = 0;
	}
		
if (tleft > 0)
   	{
	document.getElementById('timer').innerHTML='<h2> Going to reboot ballast, please wait... ' + tleft + '</h2>';
	}
else
	{
	document.getElementById('timer').innerHTML='';
	}
}
</script>

<script>
var ctrlmode = document.getElementById('ctrlmode');
var inputname = document.getElementById("apname");
var inputpass = document.getElementById("appassword");
var ipmode = document.getElementById('ipmode');
var inputipaddress = document.getElementById('ipaddress');
var ntp = document.getElementById('ntp');
var dimlevel = document.getElementById('dimlevel')

function checkinputs() {
if (ipmode.value === 'DHCP') 
    {
    inputipaddress.disabled = true;
    } 
else 
    {
    inputipaddress.disabled = false;
    }

if (m.value === 'Wifi disabled') 
    {
    inputname.disabled = true;
    inputpass.disabled = true;
    inputipaddress.disabled = true;
    ipmode.disabled = true;
    ntpenabled.disbaled = true;
    } 
else 
    {
    inputname.disabled = false;
    inputpass.disabled = false;
    ipmode.disabled = false;
    ntp.disabled = false;
    if (ipmode.value === 'DHCP') 
        {
        inputipaddress.disabled = true;
        } 
    else 
        {
        inputipaddress.disabled = false;
        }
    }
};
    
function loaddata() 
    {
    var xhttp_cause = new XMLHttpRequest();
	xhttp_cause.onreadystatechange = function() 
        {	    
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
            {
            document.getElementById("cause").innerHTML = this.responseText;
            }
        };
    xhttp_cause.open("GET", "cause", true);
    xhttp_cause.send();

    var xhttp_ssid = new XMLHttpRequest();
    xhttp_ssid.onreadystatechange = function() 
        { 
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
            {
            document.getElementById("ssid").innerHTML = this.responseText;
            }
        };
	xhttp_ssid.open("GET", "ssid", true);
	xhttp_ssid.send();

	var xhttp_foundaps = new XMLHttpRequest();
	xhttp_foundaps.onreadystatechange = function() 
	    {
	    if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
	        {
	        document.getElementById("apslist").innerHTML = this.responseText;
	        }
      };
	xhttp_foundaps.open("GET", "foundaps", true);
	xhttp_foundaps.send();

	var xhttp_name = new XMLHttpRequest();
	xhttp_name.onreadystatechange = function() 
	    {
	    if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
	        {
	        document.getElementById("name").value = this.responseText;
	        }
      };
	xhttp_name.open("GET", "name", true);
	xhttp_name.send();
	
	var xhttp_location = new XMLHttpRequest();
	xhttp_location.onreadystatechange = function() 
	    {
	    if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
	        {
	        document.getElementById("location").value = this.responseText;
	        }
      	};
	xhttp_location.open("GET", "location", true);
	xhttp_location.send();
	
	var xhttp_swversion = new XMLHttpRequest();
	xhttp_swversion.onreadystatechange = function() 
	    {
	    if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
	        {
	        document.getElementById("swversion").innerHTML = this.responseText;
	        }
      	};
	xhttp_swversion.open("GET", "swversion", true);
	xhttp_swversion.send();
	
	var xhttp_swversion = new XMLHttpRequest();
	xhttp_swversion.onreadystatechange = function() 
	    {
	    if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
	        {
	        document.getElementById("ntp").innerHTML = this.responseText;
	        }
      	};
	xhttp_swversion.open("GET", "ntp", true);
	xhttp_swversion.send();
		
    var xhttp_dimlevel = new XMLHttpRequest();
    xhttp_dimlevel.onreadystatechange = function() 
        {
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) 
            {
            var value = parseInt(this.responseText.replace(/[^0-9\.]/g, ''), 10);
            document.getElementById("dimlevel").value = value;
            document.getElementById("slidervalue").innerHTML = value + ' %';        
            }
        };
    xhttp_dimlevel.open("GET", "dimlevel", true);
    xhttp_dimlevel.send();
    };

document.addEventListener("DOMContentLoaded", function(event) 
    { 
    checkinputs(); 
    loaddata();
    }
);

selectcontrol.onchange = function() { checkinputs(); }
ipmode.onchange = function() { checkinputs(); }
</script>

</body>
</html>
